<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Meeting â€” Notetaker</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <script src="/static/theme.js"></script>
  </head>
  <body class="meeting-layout">
    <header class="meeting-header">
      <div class="title-row">
        <a href="/" class="app-brand">Notetaker</a>
        <span id="version-badge" class="version-badge">v0.0.0.0</span>
        <input id="meeting-title" type="text" class="meeting-title-inline" placeholder="Untitled meeting" />
        <div id="finalization-status" class="finalization-status-inline" style="display: none;">
          <div class="finalization-spinner small"></div>
          <span id="finalization-status-text">Processing...</span>
        </div>
        <div class="status error inline" id="global-error"></div>
        <div class="status inline" id="global-busy"></div>
        <div class="header-actions">
          <span id="transcription-status-badge" class="status-badge"></span>
          <button id="stop-transcription" class="secondary" style="display: none;">Stop</button>
          <button id="resume-transcription" class="secondary" style="display: none;">Resume</button>
          <button id="export-meeting" class="secondary">Export</button>
          <button id="delete-meeting" class="secondary">Delete</button>
        </div>
      </div>
    </header>

    <div class="meeting-body">
      <!-- Left sidebar: Attendees list -->
      <aside class="meeting-sidebar">
        <div class="sidebar-header">
          <span class="sidebar-title">Attendees</span>
          <span class="auto-rename-status" id="auto-rename-status"></span>
        </div>
        <div class="attendees-list" id="attendees-list">
          <div class="attendees-empty">No attendees detected yet.</div>
        </div>
      </aside>

      <!-- Main content: 2x2 grid -->
      <main class="meeting-main">
        <div class="meeting-grid-2x2" id="meeting-grid">
          <!-- Upper left: Transcript -->
          <section class="grid-panel transcript-panel" data-panel="transcript">
            <div class="grid-panel-header">
              <h2>Transcript</h2>
              <button class="panel-maximize-btn icon-btn" title="Maximize">&#x26F6;</button>
            </div>
            <div class="status" id="transcript-status">No transcript yet.</div>
            <div class="output transcript" id="transcript-output"></div>
          </section>

          <!-- Upper right: Summary -->
          <section class="grid-panel summary-panel" data-panel="summary">
            <div class="grid-panel-header">
              <h2>Summary</h2>
              <div class="grid-panel-actions">
                <button id="manual-summarize" class="secondary small">Summarize</button>
                <button class="panel-maximize-btn icon-btn" title="Maximize">&#x26F6;</button>
              </div>
            </div>
            <div class="status" id="summary-status">Summary will appear here.</div>
            <div class="status" id="manual-summary-status"></div>
            <div class="output" id="summary-output">No summary yet.</div>
          </section>

          <!-- Lower left: Chat -->
          <section class="grid-panel chat-panel" data-panel="chat">
            <div class="grid-panel-header">
              <h2>Chat</h2>
              <button class="panel-maximize-btn icon-btn" title="Maximize">&#x26F6;</button>
            </div>
            <div id="meeting-chat-container" class="chat-container-grid"></div>
          </section>

          <!-- Lower right: Notes -->
          <section class="grid-panel notes-panel" data-panel="notes">
            <div class="grid-panel-header">
              <h2>Notes</h2>
              <button class="panel-maximize-btn icon-btn" title="Maximize">&#x26F6;</button>
            </div>
            <textarea id="manual-notes" placeholder="Add your notes here..."></textarea>
          </section>
        </div>
      </main>

      <!-- Right sidebar: Debug panel (hidden by default) -->
      <aside class="meeting-debug-sidebar" id="debug-sidebar" style="display: none;">
        <div class="sidebar-header">
          <span class="sidebar-title">Debug</span>
          <button id="close-debug" class="icon-btn" title="Close">&#10005;</button>
        </div>
        <div class="debug-panel-content">
          <div class="row">
            <label>
              <input id="show-raw-segments" type="checkbox" />
              Show raw (unconsolidated) segments
            </label>
          </div>
          <div class="debug-section">
            <h3>Transcription (raw)</h3>
            <textarea id="manual-transcription" rows="8" readonly></textarea>
          </div>
          <div class="debug-section">
            <h3>Summary (raw)</h3>
            <textarea id="manual-summary" rows="8"></textarea>
          </div>
        </div>
      </aside>
    </div>

    <!-- Debug toggle button (fixed position, lower right) -->
    <button id="toggle-debug" class="debug-toggle-btn" title="Toggle debug panel">&#128736;</button>

    <!-- Attendee detail popover (positioned next to attendee) -->
    <div class="attendee-detail-popover" id="attendee-detail-popup" style="display: none;">
      <div class="attendee-detail-header">
        <span class="attendee-detail-name" id="attendee-detail-name">Speaker</span>
      </div>
      <div class="attendee-segments" id="attendee-segments">
        <!-- Segments shown when attendee is selected -->
      </div>
    </div>

    <script>
    // Diagnostic: catch ALL errors on this page
    window.addEventListener('error', function(e) {
      fetch('http://127.0.0.1:7242/ingest/4caeca80-116f-4cf5-9fc0-b1212b4dcd92',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'meeting.html:error_handler',message:'GLOBAL ERROR CAUGHT',data:{message:e.message||'',filename:e.filename||'',lineno:e.lineno||0,colno:e.colno||0,type:e.type||'',errorStr:e.error?String(e.error):''},timestamp:Date.now(),runId:'diag',hypothesisId:'DIAG'})}).catch(function(){});
    });
    // Diagnostic: confirm inline scripts work
    fetch('http://127.0.0.1:7242/ingest/4caeca80-116f-4cf5-9fc0-b1212b4dcd92',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'meeting.html:inline_script',message:'INLINE SCRIPT OK - about to load chat.js and meeting.js',data:{},timestamp:Date.now(),runId:'diag',hypothesisId:'DIAG'})}).catch(function(){});
    </script>
    <script src="/static/chat.js?v=1"></script>
    <script>
    fetch('http://127.0.0.1:7242/ingest/4caeca80-116f-4cf5-9fc0-b1212b4dcd92',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'meeting.html:after_chat_js',message:'AFTER chat.js loaded',data:{},timestamp:Date.now(),runId:'diag',hypothesisId:'DIAG'})}).catch(function(){});
    </script>
    <script src="/static/meeting.js?v=181"></script>
    <script>
    fetch('http://127.0.0.1:7242/ingest/4caeca80-116f-4cf5-9fc0-b1212b4dcd92',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'meeting.html:after_meeting_js',message:'AFTER meeting.js loaded',data:{typeof_state:typeof state,typeof_refreshMeeting:typeof refreshMeeting},timestamp:Date.now(),runId:'diag',hypothesisId:'DIAG'})}).catch(function(){});
    </script>
  </body>
</html>
