<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Settings — Notetaker</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <main class="container">
      <header>
        <div class="title-row">
          <a href="/" class="app-brand">Notetaker</a>
          <h1>Settings</h1>
          <span id="version-badge" class="version-badge">v0.0.0.0</span>
        </div>
        <p class="subtitle">Configure devices, transcription, and models</p>
        <div class="status error" id="global-error"></div>
        <div class="status" id="global-busy"></div>
      </header>

      <section class="panel">
        <div class="panel-header">
          <h2>Audio Devices</h2>
          <button id="refresh-devices" class="secondary">Refresh</button>
        </div>
        <div class="row-setting">
          <label for="device-select">Input device</label>
          <select id="device-select"></select>
        </div>
        <div class="row-setting">
          <label for="samplerate">Sample rate</label>
          <input id="samplerate" type="number" value="48000" min="8000" step="1000" />
        </div>
        <div class="row-setting">
          <label for="channels">Channels</label>
          <input id="channels" type="number" value="2" min="1" max="8" />
        </div>
      </section>

      <section class="panel">
        <h2>Transcription</h2>
        <div class="row-setting">
          <label for="live-model-size">Live model size</label>
          <select id="live-model-size">
            <option value="tiny">tiny</option>
            <option value="base" selected>base</option>
            <option value="small">small</option>
            <option value="medium">medium</option>
            <option value="large-v3">large-v3</option>
          </select>
        </div>
        <div class="row-setting">
          <label for="final-model-size">Final model size</label>
          <select id="final-model-size">
            <option value="tiny">tiny</option>
            <option value="base">base</option>
            <option value="small" selected>small</option>
            <option value="medium">medium</option>
            <option value="large-v3">large-v3</option>
          </select>
        </div>
        <div class="row">
          <label>
            <input id="auto-transcribe" type="checkbox" checked />
            Auto-transcribe after stop
          </label>
        </div>
        <div class="row">
          <label>
            <input id="stream-transcribe" type="checkbox" checked />
            Stream transcript updates
          </label>
        </div>
        <div class="row">
          <label>
            <input id="live-transcribe" type="checkbox" checked />
            Live transcription during recording
          </label>
        </div>
        <div class="row-setting">
          <label for="consolidation-max-duration">Consolidate chunks up to (seconds)</label>
          <input id="consolidation-max-duration" type="number" value="15" min="5" max="60" step="1" />
        </div>
        <div class="row-setting">
          <label for="consolidation-max-gap">Max gap between chunks (seconds)</label>
          <input id="consolidation-max-gap" type="number" value="2" min="0.5" max="10" step="0.5" />
        </div>
        <div class="output" id="transcription-output"></div>
      </section>

      <section class="panel">
        <h2>Real-Time Diarization</h2>
        <p class="panel-description">
          Identifies speakers during live transcription. Provides immediate speaker labels but lower accuracy.
          Only <strong>diart</strong> supports real-time operation.
        </p>
        <div class="row">
          <label for="realtime-diarization-enabled">
            <input id="realtime-diarization-enabled" type="checkbox" />
            Enable real-time speaker detection
          </label>
        </div>
        <div class="row-setting">
          <label for="realtime-diarization-provider">Provider</label>
          <select id="realtime-diarization-provider">
            <option value="none">Off</option>
            <option value="diart">diart — Real-time streaming</option>
          </select>
        </div>
        <div class="row-setting" id="realtime-device-row">
          <label for="realtime-diarization-device">Device</label>
          <select id="realtime-diarization-device">
            <option value="cpu">CPU</option>
            <option value="cuda">CUDA (GPU)</option>
          </select>
        </div>
        <div class="row" id="realtime-performance-row">
          <label for="realtime-performance-level">Latency / Accuracy tradeoff</label>
          <input id="realtime-performance-level" type="range" min="0" max="1" step="0.1" value="0.5" />
          <div class="hint">Lower = faster but less accurate. Higher = slower but more accurate.</div>
        </div>
        <div class="row" id="realtime-token-row">
          <label for="realtime-hf-token">Hugging Face token</label>
          <input id="realtime-hf-token" type="password" placeholder="hf_..." />
          <div class="hint">
            Get your free token at
            <a href="https://huggingface.co/settings/tokens" target="_blank">huggingface.co/settings/tokens</a>.
          </div>
        </div>
        <div class="output" id="realtime-diarization-output"></div>
      </section>

      <section class="panel">
        <h2>Final Diarization</h2>
        <p class="panel-description">
          Identifies speakers after transcription completes. Higher accuracy with named speaker identification.
          Runs during the finalization step.
        </p>
        <div class="row">
          <label for="batch-diarization-enabled">
            <input id="batch-diarization-enabled" type="checkbox" />
            Enable final speaker identification
          </label>
        </div>
        <div class="row-setting">
          <label for="batch-diarization-provider">Provider</label>
          <select id="batch-diarization-provider">
            <option value="none">Off</option>
            <option value="pyannote">pyannote 3.1 — High accuracy</option>
            <option value="whisperx">whisperx — WhisperX-based</option>
          </select>
        </div>
        <div class="row-setting">
          <label for="batch-diarization-model">Model</label>
          <select id="batch-diarization-model">
            <option value="pyannote/speaker-diarization-3.1">pyannote/speaker-diarization-3.1</option>
            <option value="pyannote/speaker-diarization-3.0">pyannote/speaker-diarization-3.0 (faster on CPU)</option>
          </select>
        </div>
        <div class="row-setting" id="batch-device-row">
          <label for="batch-diarization-device">Device</label>
          <select id="batch-diarization-device">
            <option value="cpu">CPU</option>
            <option value="cuda">CUDA (GPU)</option>
          </select>
        </div>
        <div class="row" id="batch-token-row">
          <label for="batch-hf-token">Hugging Face token</label>
          <input id="batch-hf-token" type="password" placeholder="hf_..." />
          <div class="hint">
            Get your free token at
            <a href="https://huggingface.co/settings/tokens" target="_blank">huggingface.co/settings/tokens</a>.
            You must also accept the model terms at
            <a href="https://huggingface.co/pyannote/speaker-diarization-3.1" target="_blank">pyannote model page</a>.
          </div>
        </div>
        <div class="actions">
          <button id="test-diarization-access" class="secondary">Test HuggingFace Access</button>
        </div>
        <div class="output" id="batch-diarization-output"></div>
      </section>

      <section class="panel">
        <h2>AI Models</h2>
        <div class="row-setting">
          <label for="model-choice">Choose model</label>
          <input id="model-choice" type="text" placeholder="Select or type a model" list="model-options" />
          <datalist id="model-options"></datalist>
        </div>
        <div class="hint" id="model-empty-hint" style="margin-bottom: 12px;">
          No visible models yet. Enable models below.
        </div>
        <div class="row">
          <label>Discovered models</label>
          <input
            id="model-filter"
            type="text"
            placeholder="Filter discovered models"
          />
          <div class="model-registry" id="model-registry"></div>
          <div class="hint">
            Models are hidden by default. Toggle visibility to make them selectable.
          </div>
        </div>

        <div class="provider-block">
          <h3>OpenAI</h3>
          <div class="row-setting">
            <label for="openai-api-key">API key</label>
            <input id="openai-api-key" type="password" placeholder="sk-..." />
          </div>
          <div class="row-setting-with-buttons">
            <label for="openai-base-url">Base URL</label>
            <input id="openai-base-url" type="text" value="https://api.openai.com" />
            <button id="openai-default" class="secondary">Default</button>
            <button id="test-openai" class="secondary">Test</button>
            <span id="openai-status" class="status-pill"></span>
          </div>
        </div>

        <div class="provider-block">
          <h3>Anthropic</h3>
          <div class="row-setting">
            <label for="anthropic-api-key">API key</label>
            <input id="anthropic-api-key" type="password" placeholder="sk-ant-..." />
          </div>
          <div class="row-setting-with-buttons">
            <label for="anthropic-base-url">Base URL</label>
            <input id="anthropic-base-url" type="text" value="https://api.anthropic.com" />
            <button id="anthropic-default" class="secondary">Default</button>
            <button id="test-anthropic" class="secondary">Test</button>
            <span id="anthropic-status" class="status-pill"></span>
          </div>
        </div>

        <div class="provider-block">
          <h3>Gemini</h3>
          <div class="row-setting">
            <label for="gemini-api-key">API key</label>
            <input id="gemini-api-key" type="password" placeholder="AIza..." />
          </div>
          <div class="row-setting-with-buttons">
            <label for="gemini-base-url">Base URL</label>
            <input id="gemini-base-url" type="text" value="https://generativelanguage.googleapis.com" />
            <button id="gemini-default" class="secondary">Default</button>
            <button id="test-gemini" class="secondary">Test</button>
            <span id="gemini-status" class="status-pill"></span>
          </div>
        </div>

        <div class="provider-block">
          <h3>Grok</h3>
          <div class="row-setting">
            <label for="grok-api-key">API key</label>
            <input id="grok-api-key" type="password" placeholder="xai-..." />
          </div>
          <div class="row-setting-with-buttons">
            <label for="grok-base-url">Base URL</label>
            <input id="grok-base-url" type="text" value="https://api.x.ai" />
            <button id="grok-default" class="secondary">Default</button>
            <button id="test-grok" class="secondary">Test</button>
            <span id="grok-status" class="status-pill"></span>
          </div>
        </div>

        <div class="provider-block">
          <h3>Ollama</h3>
          <div class="row-setting">
            <label for="ollama-api-key">API key (optional)</label>
            <input id="ollama-api-key" type="password" placeholder="optional" />
          </div>
          <div class="row-setting-with-buttons">
            <label for="ollama-base-url">Base URL</label>
            <input id="ollama-base-url" type="text" value="http://127.0.0.1:11434" />
            <button id="ollama-default" class="secondary">Default</button>
            <button id="test-ollama" class="secondary">Test</button>
            <span id="ollama-status" class="status-pill"></span>
          </div>
        </div>

        <div class="provider-block">
          <h3>LM Studio</h3>
          <div class="row-setting">
            <label for="lmstudio-api-key">API key (optional)</label>
            <input id="lmstudio-api-key" type="password" placeholder="optional" />
          </div>
          <div class="row-setting-with-buttons">
            <label for="lmstudio-base-url">Base URL</label>
            <input id="lmstudio-base-url" type="text" value="http://127.0.0.1:1234" />
            <button id="lmstudio-default" class="secondary">Default</button>
            <button id="test-lmstudio" class="secondary">Test</button>
            <span id="lmstudio-status" class="status-pill"></span>
          </div>
        </div>

        <div class="output" id="model-output"></div>
      </section>

      <section class="panel">
        <h2>Developer Tools</h2>
        <p class="panel-description">
          Tools for debugging and testing the application.
        </p>
        <div class="actions">
          <a href="/test" class="button-link">Open Test Harness</a>
        </div>
      </section>
    </main>

    <script src="/static/settings.js"></script>
  </body>
</html>
